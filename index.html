<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dodge Game</title>
    <style>
		html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  width: 100%;
  height: 100%;
}

canvas {
  width: 100vw;   /* gunakan ukuran viewport HP */
  height: 100vh;
  display: block;
  touch-action: none;
}

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        width: 100%;
        height: 100%;
        overflow: hidden;
        background-color: #111;
        font-family: Arial, sans-serif;
      }

      canvas {
        display: block;
        background-color: #222;
      }

      #loginScreen,
      #leaderboardScreen {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        z-index: 100;
      }

      .login-container,
      .leaderboard-container {
        background: rgba(255, 255, 255, 0.95);
        padding: 40px;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        text-align: center;
        max-width: 400px;
        width: 90%;
      }

      .leaderboard-container {
        max-width: 500px;
        max-height: 80vh;
        overflow-y: auto;
      }

      h1 {
        color: #333;
        margin-bottom: 10px;
        font-size: 36px;
      }

      h2 {
        color: #667eea;
        margin-bottom: 20px;
        font-size: 24px;
      }

      .subtitle {
        color: #666;
        margin-bottom: 30px;
        font-size: 14px;
      }

      input {
        width: 100%;
        padding: 15px;
        margin-bottom: 20px;
        border: 2px solid #ddd;
        border-radius: 10px;
        font-size: 16px;
        transition: border-color 0.3s;
      }

      input:focus {
        outline: none;
        border-color: #667eea;
      }

      button {
        width: 100%;
        padding: 15px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        margin-bottom: 10px;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
      }

      button:active {
        transform: translateY(0);
      }

      .secondary-btn {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      }

      .game-controls {
        position: absolute;
        top: 20px;
        right: 20px;
        z-index: 50;
        display: flex;
        gap: 10px;
      }

      .control-btn {
        padding: 12px 20px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s;
        width: auto;
      }

      .control-btn:hover {
        background: rgba(0, 0, 0, 0.9);
        border-color: rgba(255, 255, 255, 0.6);
        transform: translateY(-2px);
      }

      .leaderboard-list {
        margin-top: 20px;
        text-align: left;
      }

      .leaderboard-item {
        display: flex;
        justify-content: space-between;
        padding: 12px;
        margin-bottom: 8px;
        background: #f8f9fa;
        border-radius: 8px;
        border-left: 4px solid #667eea;
      }

      .leaderboard-item.current-user {
        background: #e8f0ff;
        border-left-color: #f5576c;
      }

      .rank {
        font-weight: bold;
        color: #667eea;
        min-width: 30px;
      }

      .player-name {
        flex: 1;
        padding: 0 10px;
        color: #333;
      }

      .player-score {
        font-weight: bold;
        color: #764ba2;
      }

      .hidden {
        display: none !important;
      }

      .player-info {
        position: absolute;
        top: 160px;
        left: 15px;
        background: rgba(0, 0, 0, 0.6);
        padding: 12px;
        border-radius: 8px;
        color: white;
        font-size: 18px;
        z-index: 40;
      }

      #liveLeaderboard {
        position: absolute;
        top: 220px;
        left: 15px;
        background: rgba(0, 0, 0, 0.75);
        padding: 15px;
        border-radius: 12px;
        min-width: 280px;
        max-width: 350px;
        z-index: 40;
        border: 2px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      }

      #liveLeaderboard.hidden {
        display: none;
      }

      .live-leaderboard-title {
        color: #ffd700;
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 12px;
        text-align: center;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        border-bottom: 2px solid rgba(255, 215, 0, 0.3);
        padding-bottom: 8px;
      }

      .live-leaderboard-item {
        display: flex;
        align-items: center;
        padding: 8px 10px;
        margin-bottom: 6px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 6px;
        border-left: 3px solid transparent;
        transition: all 0.3s;
      }

      .live-leaderboard-item:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: translateX(3px);
      }

      .live-leaderboard-item.rank-1 {
        border-left-color: #ffd700;
        background: rgba(255, 215, 0, 0.1);
      }

      .live-leaderboard-item.rank-2 {
        border-left-color: #c0c0c0;
      }

      .live-leaderboard-item.rank-3 {
        border-left-color: #cd7f32;
      }

      .live-leaderboard-item.current {
        background: rgba(102, 126, 234, 0.2);
        border-left-color: #667eea;
        box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
      }

      .live-rank {
        font-weight: bold;
        color: #ffd700;
        min-width: 32px;
        font-size: 16px;
        text-align: center;
      }

      .live-player-name {
        flex: 1;
        color: #fff;
        font-size: 15px;
        margin: 0 10px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 160px;
      }

      .live-player-score {
        font-weight: bold;
        color: #4ade80;
        font-size: 16px;
        min-width: 45px;
        text-align: right;
      }

      .live-trophy {
        margin-right: 5px;
        font-size: 18px;
      }
</style>
<style>
  .touch-controls {
    position: absolute;
    bottom: 40px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 99;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    user-select: none;
  }

  .horizontal-btns {
    display: flex;
    gap: 12px;
  }

  .btn-move {
    width: 70px;
    height: 70px;
    border-radius: 15px;
    border: 2px solid rgba(255,255,255,0.5);
    background: rgba(0,0,0,0.5);
    color: white;
    font-size: 32px;
    font-weight: bold;
    cursor: pointer;
  }

  .btn-move:active {
    background: rgba(255,255,255,0.2);
  }
    </style>

    </style>
  </head>
  <body>
    <!-- Login Screen -->
    <div id="loginScreen">
      <div class="login-container">
        <h1>üöó Dodge Game</h1>
        <p class="subtitle">Hindari truk dan raih skor tertinggi!</p>
        <input
          type="text"
          id="playerNameInput"
          placeholder="Masukkan nama Anda..."
          maxlength="20"
        />
        <button onclick="startGame()">Mulai Bermain</button>
        <button class="secondary-btn" onclick="showLeaderboard()">
          üèÜ Lihat Leaderboard
        </button>
      </div>
    </div>

    <!-- Leaderboard Screen -->
    <div id="leaderboardScreen" class="hidden">
      <div class="leaderboard-container">
        <h2>üèÜ Leaderboard</h2>
        <div id="leaderboardList" class="leaderboard-list"></div>
        <button onclick="hideLeaderboard()">Kembali</button>
      </div>
    </div>

    <!-- Game Controls -->
    <div id="gameControls" class="game-controls hidden">
      <button class="control-btn" onclick="showLeaderboardInGame()">
        üèÜ Leaderboard
      </button>
      <button class="control-btn" onclick="restartGame()">üîÑ Restart</button>
      <button class="control-btn" onclick="logout()">üö™ Logout</button>
    </div>

    <!-- Player Info -->
    <div id="playerInfo" class="player-info hidden"></div>

    <!-- Live Leaderboard -->
    <div id="liveLeaderboard" class="hidden">
      <div class="live-leaderboard-title">üèÜ LEADERBOARD</div>
      <div id="liveLeaderboardContent"></div>
    </div>

    <canvas id="gameCanvas"></canvas>
<!-- Mobile Touch Controls -->
<div id="touchControls" class="touch-controls hidden">
  <button class="btn-move up"    data-key="w">‚ñ≤</button>
  <div class="horizontal-btns">
    <button class="btn-move left"  data-key="a">‚óÄ</button>
    <button class="btn-move right" data-key="d">‚ñ∂</button>
  </div>
  <button class="btn-move down"  data-key="s">‚ñº</button>
</div>

    <script>

      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");

      const playerImage = new Image();
      playerImage.src = "mobil.png";

      const truckImage = new Image();
      truckImage.src = "truk2.png";

      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      // Game State
      let currentPlayer = null;
      let gameStarted = false;
      let gameOver = false;

      // Leaderboard Data (stored in memory)
      let leaderboardData = [];

      // Load leaderboard from memory or initialize
      function loadLeaderboard() {
        // No demo data - starts empty
      }

      function saveToLeaderboard(name, score) {
        // Cari apakah nama sudah ada
        const existingIndex = leaderboardData.findIndex(
          (entry) => entry.name === name
        );

        if (existingIndex !== -1) {
          // Nama sudah ada, update jika score lebih tinggi
          if (score > leaderboardData[existingIndex].score) {
            leaderboardData[existingIndex].score = score;
          }
        } else {
          // Nama belum ada, tambahkan entry baru
          leaderboardData.push({ name, score });
        }

        // Sort dan ambil top 10
        leaderboardData.sort((a, b) => b.score - a.score);
        leaderboardData = leaderboardData.slice(0, 10);

        // Update live leaderboard display
        updateLiveLeaderboard();
      }

      function updateLiveLeaderboard() {
        const content = document.getElementById("liveLeaderboardContent");
        content.innerHTML = "";

        if (leaderboardData.length === 0) {
          content.innerHTML =
            "<p style='text-align:center; color:#999; font-size:14px;'>Belum ada data</p>";
          return;
        }

        // Tampilkan top 5 saja di live leaderboard
        const topFive = leaderboardData.slice(0, 5);

        topFive.forEach((entry, index) => {
          const item = document.createElement("div");
          item.className = "live-leaderboard-item";

          // Tambah class untuk ranking
          if (index === 0) item.classList.add("rank-1");
          if (index === 1) item.classList.add("rank-2");
          if (index === 2) item.classList.add("rank-3");

          // Highlight current player
          if (currentPlayer && entry.name === currentPlayer) {
            item.classList.add("current");
          }

          // Trophy emoji untuk top 3
          let trophy = "";
          if (index === 0) trophy = '<span class="live-trophy">ü•á</span>';
          else if (index === 1) trophy = '<span class="live-trophy">ü•à</span>';
          else if (index === 2) trophy = '<span class="live-trophy">ü•â</span>';

          item.innerHTML = `
            ${trophy}
            <span class="live-rank">#${index + 1}</span>
            <span class="live-player-name">${entry.name}</span>
            <span class="live-player-score">${entry.score}</span>
          `;
          content.appendChild(item);
        });
      }

      function displayLeaderboard() {
        const list = document.getElementById("leaderboardList");
        list.innerHTML = "";

        if (leaderboardData.length === 0) {
          list.innerHTML =
            "<p style='text-align:center; color:#999;'>Belum ada data</p>";
          return;
        }

        leaderboardData.forEach((entry, index) => {
          const item = document.createElement("div");
          item.className = "leaderboard-item";
          if (currentPlayer && entry.name === currentPlayer) {
            item.classList.add("current-user");
          }
          item.innerHTML = `
            <span class="rank">#${index + 1}</span>
            <span class="player-name">${entry.name}</span>
            <span class="player-score">${entry.score}</span>
          `;
          list.appendChild(item);
        });
      }

      function startGame() {
        const nameInput = document.getElementById("playerNameInput");
	document.getElementById("playerInfo").classList.remove("hidden");
	document.getElementById("touchControls").classList.remove("hidden");


        const name = nameInput.value.trim();

        if (!name) {
          alert("Silakan masukkan nama Anda!");
          return;
        }

        currentPlayer = name;
        document.getElementById("loginScreen").classList.add("hidden");
        document.getElementById("gameControls").classList.remove("hidden");
        document.getElementById("playerInfo").classList.remove("hidden");
        document.getElementById("liveLeaderboard").classList.remove("hidden");
        document.getElementById(
          "playerInfo"
        ).textContent = `üë§ ${currentPlayer}`;

        gameStarted = true;
        resetGame();
        updateLiveLeaderboard();
        gameLoop();
      }

      function showLeaderboard() {
        loadLeaderboard();
        displayLeaderboard();
        document.getElementById("loginScreen").classList.add("hidden");
        document.getElementById("leaderboardScreen").classList.remove("hidden");
      }

      function hideLeaderboard() {
        document.getElementById("leaderboardScreen").classList.add("hidden");
        if (gameStarted) {
          // Return to game
        } else {
          document.getElementById("loginScreen").classList.remove("hidden");
        }
      }

      function showLeaderboardInGame() {
        loadLeaderboard();
        displayLeaderboard();
        document.getElementById("leaderboardScreen").classList.remove("hidden");
        gameOver = true; // Pause game
      }

      function restartGame() {
        if (score > 0) {
          saveToLeaderboard(currentPlayer, score);
        }
        resetGame();
        if (gameOver) {
          gameOver = false;
          gameLoop();
        }
      }

      function logout() {
        if (score > 0) {
          saveToLeaderboard(currentPlayer, score);
        }
        currentPlayer = null;
        gameStarted = false;
        gameOver = true;
        bestScore = 0; // Reset best score saat logout
        document.getElementById("gameControls").classList.add("hidden");
        document.getElementById("playerInfo").classList.add("hidden");
        document.getElementById("liveLeaderboard").classList.add("hidden");
        document.getElementById("loginScreen").classList.remove("hidden");
        document.getElementById("playerNameInput").value = "";
      }

      function resetGame() {
        score = 0;
        level = 1;
        nextLevelScore = 10;
        obstacles = [];
        spawnInterval = 1500;
        lastSpawn = 0;
        gameOver = false;
        showLevelPopup = false;
        player.x = canvas.width / 2 - player.width / 2;
        player.y = canvas.height - 120;
      }

      // Jalan
     const road = {
  laneWidth: window.innerWidth < 768 
    ? canvas.width * 0.9 
    : canvas.width * 0.55,
  stripeWidth: 10,
  stripeHeight: 40,
  gap: 30,
  speed: 5,
  offset: 0,
};


      function drawRoad() {
        const theme = getCurrentTheme();
        const centerX = canvas.width / 2;

        ctx.fillStyle = theme.roadColor || "#111";
        ctx.fillRect(
          centerX - road.laneWidth / 2,
          0,
          road.laneWidth,
          canvas.height
        );

        ctx.fillStyle = theme.stripeColor || "white";
        let y = -road.stripeHeight + road.offset;
        while (y < canvas.height) {
          ctx.fillRect(
            centerX - road.stripeWidth / 2,
            y,
            road.stripeWidth,
            road.stripeHeight
          );
          y += road.stripeHeight + road.gap;
        }

        road.offset += road.speed;
        if (road.offset >= road.stripeHeight + road.gap) {
          road.offset = 0;
        }
      }

      function drawBiomeSides() {
        const theme = getCurrentTheme();
        const sideWidth = (canvas.width - road.laneWidth) / 2;
        theme.sideFill(ctx, 0, 0, sideWidth, canvas.height);
        theme.sideFill(
          ctx,
          canvas.width - sideWidth,
          0,
          sideWidth,
          canvas.height
        );
      }

      // Player
      const player = {
        x: canvas.width / 2 - 50,
        y: canvas.height - 120,
        width: 100,
        height: 100,
        speed: 6,
        vx: 0,
      };

      const playerHitbox = {
        offsetX: 30,
        offsetY: 5,
        width: 40,
        height: 90,
      };

      player.x = canvas.width / 2 - player.width / 2;

      let keys = { a: false, d: false, w: false, s: false };

      document.addEventListener("keydown", (e) => {
        if (e.key.toLowerCase() === "a") keys.a = true;
        if (e.key.toLowerCase() === "d") keys.d = true;
        if (e.key.toLowerCase() === "w") keys.w = true;
        if (e.key.toLowerCase() === "s") keys.s = true;
      });

      document.addEventListener("keyup", (e) => {
        if (e.key.toLowerCase() === "a") keys.a = false;
        if (e.key.toLowerCase() === "d") keys.d = false;
        if (e.key.toLowerCase() === "w") keys.w = false;
        if (e.key.toLowerCase() === "s") keys.s = false;
      });

      // Obstacles
      let obstacles = [];
      let spawnInterval = 1500;
      let lastSpawn = 0;

      // Score & Level
      let score = 0;
      let bestScore = 0;
      let level = 1;
      let nextLevelScore = 10;
      let showLevelPopup = false;
      let popupTimer = 0;

      function createObstacle() {
        if (!truckImage.width || !truckImage.height) return;

        const desiredHeight = 120;
        const desiredWidth =
          desiredHeight * (truckImage.width / truckImage.height);

        const minX = canvas.width / 2 - road.laneWidth / 2;
        const maxX = canvas.width / 2 + road.laneWidth / 2 - desiredWidth;

        const x = Math.random() * (maxX - minX) + minX;
        const speed = 2 + Math.random() * 3;

        const hitboxPaddingX = 55;
        const hitboxPaddingY = 10;

        obstacles.push({
          x,
          y: -desiredHeight,
          width: desiredWidth,
          height: desiredHeight,
          speed,
          hitbox: {
            x: x + hitboxPaddingX,
            y: -desiredHeight + hitboxPaddingY,
            width: desiredWidth - hitboxPaddingX * 2,
            height: desiredHeight - hitboxPaddingY * 2,
          },
        });
      }

      function updatePlayer() {
        player.vx = 0;
        let vy = 0;

        if (keys.a) player.vx = -player.speed;
        if (keys.d) player.vx = player.speed;
        if (keys.w) vy = -player.speed;
        if (keys.s) vy = player.speed;

        player.x += player.vx;
        player.y += vy;

        const leftBoundary = canvas.width / 2 - road.laneWidth / 2;
        const rightBoundary =
          canvas.width / 2 + road.laneWidth / 2 - player.width;

        if (player.x < leftBoundary) player.x = leftBoundary;
        if (player.x > rightBoundary) player.x = rightBoundary;
        if (player.y < 0) player.y = 0;
        if (player.y + player.height > canvas.height)
          player.y = canvas.height - player.height;
      }

      function updateObstacles() {
        if (!lastSpawn || Date.now() - lastSpawn > spawnInterval) {
          createObstacle();
          lastSpawn = Date.now();
          spawnInterval = Math.max(400, spawnInterval - 10);
        }

        for (let ob of obstacles) {
          ob.y += ob.speed;
          ob.hitbox.y += ob.speed;
        }

        obstacles = obstacles.filter((ob) => {
          if (ob.y > canvas.height) {
            score++;
            if (score > bestScore) {
              bestScore = score;
            }

            if (score >= nextLevelScore) {
              level++;
              nextLevelScore += 10;
              showLevelPopup = true;
              popupTimer = Date.now();
              spawnInterval = Math.max(300, spawnInterval - 200);
            }

            return false;
          }
          return true;
        });
      }

      function detectCollision(rect1, rect2) {
        const r1 = {
          x: rect1.x + playerHitbox.offsetX,
          y: rect1.y + playerHitbox.offsetY,
          width: playerHitbox.width,
          height: playerHitbox.height,
        };

        const r2 = rect2.hitbox || rect2;

        return (
          r1.x < r2.x + r2.width &&
          r1.x + r1.width > r2.x &&
          r1.y < r2.y + r2.height &&
          r1.y + r1.height > r2.y
        );
      }

      function checkCollisions() {
        for (let ob of obstacles) {
          if (detectCollision(player, ob)) {
            gameOver = true;
            saveToLeaderboard(currentPlayer, score);
          }
        }
      }

      function drawPlayer() {
        ctx.drawImage(
          playerImage,
          player.x,
          player.y,
          player.width,
          player.height
        );
      }

      function drawObstacles() {
        obstacles.forEach((ob) => {
          ctx.save();
          ctx.translate(ob.x + ob.width / 2, ob.y + ob.height / 2);
          ctx.rotate((3 * Math.PI) / 2);
          ctx.drawImage(
            truckImage,
            -ob.width / 2,
            -ob.height / 2,
            ob.width,
            ob.height
          );
          ctx.restore();
        });
      }

      function drawScore() {
        ctx.save();

        const padding = 12;
        ctx.font = "24px Arial";
        ctx.textAlign = "left";
        ctx.textBaseline = "top";

        const textScore = `Score: ${score}`;
        const textBest = `Best: ${bestScore}`;
        const textLevel = `Level: ${level}`;

        const lineHeight = 28;

        const maxTextWidth = Math.max(
          ctx.measureText(textScore).width,
          ctx.measureText(textBest).width,
          ctx.measureText(textLevel).width
        );

        const bgWidth = maxTextWidth + padding * 2;
        const bgHeight = lineHeight * 3 + padding * 2;

        const boxX = 15;
        const boxY = 20;
        ctx.fillStyle = "rgba(0, 0, 0, 0.6)";
        ctx.fillRect(boxX, boxY, bgWidth, bgHeight);

        let x = boxX + padding;
        let y = boxY + padding;

        ctx.fillStyle = "white";
        ctx.fillText(textScore, x, y);

        y += lineHeight;
        ctx.fillStyle = "yellow";
        ctx.fillText(textBest, x, y);

        y += lineHeight;
        ctx.fillStyle = "cyan";
        ctx.fillText(textLevel, x, y);

        ctx.restore();
      }

      function drawGameOver() {
        ctx.save();
        ctx.fillStyle = "rgba(0, 0, 0, 0.8)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.fillStyle = "yellow";
        ctx.font = "64px Arial";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText("GAME OVER", canvas.width / 2, canvas.height / 2 - 50);

        ctx.fillStyle = "white";
        ctx.font = "32px Arial";
        ctx.fillText(
          `Final Score: ${score}`,
          canvas.width / 2,
          canvas.height / 2 + 20
        );

        ctx.font = "24px Arial";
        ctx.fillStyle = "cyan";
        ctx.fillText(
          "Klik RESTART untuk main lagi",
          canvas.width / 2,
          canvas.height / 2 + 70
        );

        ctx.restore();
      }

      function drawLevelPopup() {
        if (showLevelPopup) {
          ctx.fillStyle = "white";
          ctx.font = "60px Arial";
          ctx.textAlign = "center";
          ctx.fillText(
            `LEVEL ${level}`,
            canvas.width / 2,
            canvas.height / 2 - 100
          );

          if (Date.now() - popupTimer > 2000) {
            showLevelPopup = false;
          }
        }
      }

      // ===== THEME SYSTEM =====
      const levelsPerTheme = 3;

      const THEMES = [
        {
          name: "Desert",
          roadColor: "#111",
          stripeColor: "white",
          sideFill(ctx, x, y, w, h) {
            ctx.fillStyle = "#f4a261";
            ctx.fillRect(x, y, w, h);
          },
        },
        {
          name: "Grassland",
          roadColor: "#3a3a3a",
          stripeColor: "#f7f7f7",
          sideFill(ctx, x, y, w, h) {
            const g = ctx.createLinearGradient(0, y, 0, y + h);
            g.addColorStop(0, "#7ec850");
            g.addColorStop(1, "#2c7c31");
            ctx.fillStyle = g;
            ctx.fillRect(x, y, w, h);
            drawGrassLines(ctx, x, y, w, h);
          },
        },
        {
          name: "Ocean",
          roadColor: "#0f1a2b",
          stripeColor: "#a8d5ff",
          sideFill(ctx, x, y, w, h) {
            const g = ctx.createLinearGradient(0, y, 0, y + h);
            g.addColorStop(0, "#69a9ff");
            g.addColorStop(1, "#0b4ea2");
            ctx.fillStyle = g;
            ctx.fillRect(x, y, w, h);
            drawWaves(ctx, x, y, w, h);
          },
        },
        {
          name: "Snow",
          roadColor: "#263238",
          stripeColor: "#e0f7fa",
          sideFill(ctx, x, y, w, h) {
            ctx.fillStyle = "#e9f5ff";
            ctx.fillRect(x, y, w, h);
            drawSnowDots(ctx, x, y, w, h);
          },
        },
      ];

      function getCurrentThemeIndex() {
        return Math.floor((level - 1) / levelsPerTheme) % THEMES.length;
      }
      function getCurrentTheme() {
        return THEMES[getCurrentThemeIndex()];
      }

      function drawGrassLines(ctx, x, y, w, h) {
        ctx.save();
        ctx.strokeStyle = "rgba(0,0,0,0.15)";
        ctx.lineWidth = 1;
        const gapY = 22;
        const startY = road.offset % gapY;
        for (let yy = y - startY; yy < y + h; yy += gapY) {
          ctx.beginPath();
          ctx.moveTo(x + 8, yy);
          ctx.lineTo(x + w - 8, yy);
          ctx.stroke();
        }
        ctx.restore();
      }

      function drawWaves(ctx, x, y, w, h) {
        ctx.save();
        ctx.strokeStyle = "rgba(255,255,255,0.3)";
        ctx.lineWidth = 2;
        const amp = 4;
        const gapY = 18;
        const freq = 0.03;
        const startY = road.offset % gapY;
        for (let yy = y - startY; yy < y + h; yy += gapY) {
          ctx.beginPath();
          for (let xx = x; xx <= x + w; xx += 8) {
            const dy = Math.sin(xx * freq + yy * 0.05) * amp;
            if (xx === x) ctx.moveTo(xx, yy + dy);
            else ctx.lineTo(xx, yy + dy);
          }
          ctx.stroke();
        }
        ctx.restore();
      }

      function drawSnowDots(ctx, x, y, w, h) {
        ctx.save();
        ctx.fillStyle = "rgba(255,255,255,0.7)";
        const gap = 26;
        const start = road.offset % gap;
        for (let yy = y - start; yy < y + h; yy += gap) {
          for (let xx = x + 8; xx < x + w; xx += gap) {
            ctx.beginPath();
            ctx.arc(xx, yy, 1.6, 0, Math.PI * 2);
            ctx.fill();
          }
        }
        ctx.restore();
      }

      function drawSignature() {
        ctx.save();
        ctx.font = "18px Arial";
        ctx.fillStyle = "rgba(0, 0, 0, 0.7)";
        ctx.textAlign = "left";
        ctx.textBaseline = "bottom";
        ctx.fillText("by Leon & Ghali", 20, canvas.height - 20);
        ctx.restore();
      }

      function gameLoop() {
        if (!gameStarted) return;

        drawBiomeSides();
        drawRoad();

        if (!gameOver) {
          updatePlayer();
          updateObstacles();
          checkCollisions();
        }

        drawPlayer();
        drawObstacles();
        drawScore();
        drawLevelPopup();
        drawSignature();

        if (gameOver) {
          drawGameOver();
        }

        requestAnimationFrame(gameLoop);
      }

      window.addEventListener("resize", () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  road.laneWidth = window.innerWidth < 768 
    ? canvas.width * 0.9 
    : canvas.width * 0.55;

  player.y = canvas.height - 120;
  player.x = canvas.width / 2 - player.width / 2;
});


      // Initialize
      loadLeaderboard();
// === TOUCH BUTTON CONTROLS ===
const btns = document.querySelectorAll(".btn-move");

btns.forEach(btn => {
  const key = btn.dataset.key;

  btn.addEventListener("touchstart", e => {
    e.preventDefault();
    keys[key] = true;
  });
  btn.addEventListener("mousedown", () => {
    keys[key] = true;
  });

  btn.addEventListener("touchend", e => {
    e.preventDefault();
    keys[key] = false;
  });
  btn.addEventListener("mouseup", () => {
    keys[key] = false;
  });

  btn.addEventListener("mouseleave", () => {
    keys[key] = false;
  });
});

    </script>

  </body>
</html>


